<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employer Dashboard - JobPortal</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f5f5f5;
        color: #333;
      }

      .dashboard-container {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: 250px;
        background-color: #2c3e50;
        color: white;
        padding: 20px 0;
      }

      .profile {
        text-align: center;
        padding: 20px;
        border-bottom: 1px solid #34495e;
      }

      .avatar {
        width: 80px;
        height: 80px;
        background-color: #34495e;
        border-radius: 50%;
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
      }

      nav ul {
        list-style: none;
        padding: 20px 0;
      }

      nav li {
        margin-bottom: 5px;
      }

      nav a {
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        display: block;
        transition: all 0.3s;
      }

      nav a:hover,
      nav li.active a {
        background-color: #34495e;
      }

      nav i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      .main-content {
        flex: 1;
        padding: 20px;
      }

      .dashboard-header {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background-color: #3498db;
        color: white;
        padding: 15px;
        border-radius: 5px;
        text-align: center;
        flex: 1;
      }

      .dashboard-section {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }

      textarea {
        resize: vertical;
      }

      .form-row {
        display: flex;
        gap: 20px;
      }

      .form-row .form-group {
        flex: 1;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }

      .btn-primary {
        background-color: #3498db;
        color: white;
      }

      .btn-primary:hover {
        background-color: #2980b9;
      }

      .btn-danger {
        background-color: #e74c3c;
        color: white;
      }

      .btn-danger:hover {
        background-color: #dc2626;
      }

      .job-listings,
      .applications-list {
        display: grid;
        gap: 15px;
      }

      .job-card {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #3498db;
      }

      .job-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      /* Application cards styles */
      .application-card {
        background-color: white;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #4f46e5;
        transition: all 0.2s ease;
      }

      .application-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .applicant-info {
        background-color: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
      }

      .application-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }

      /* Status styles */
      .status-pending {
        background-color: #fef3c7;
        color: #d97706;
        padding: 2px 8px;
        border-radius: 4px;
      }

      .status-accepted {
        background-color: #d1fae5;
        color: #059669;
        padding: 2px 8px;
        border-radius: 4px;
      }

      .status-rejected {
        background-color: #fee2e2;
        color: #dc2626;
        padding: 2px 8px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <aside class="sidebar">
        <div class="profile">
          <div class="avatar">
            <i class="fas fa-building"></i>
          </div>
          <h3 id="userName">Company Name</h3>
          <p>Employer</p>
        </div>
        <nav>
          <ul>
            <li class="active">
              <a href="#"><i class="fas fa-home"></i> Dashboard</a>
            </li>
            <li>
              <a href="#post-job"
                ><i class="fas fa-plus-circle"></i> Post a Job</a
              >
            </li>
            <li>
              <a href="#manage-jobs"
                ><i class="fas fa-briefcase"></i> Manage Jobs</a
              >
            </li>
            <li>
              <a href="#applications"
                ><i class="fas fa-file-alt"></i> Applications</a
              >
            </li>
            <li>
              <a href="#profile"
                ><i class="fas fa-user-cog"></i> Company Profile</a
              >
            </li>
            <li>
              <a href="login.html" id="logout"
                ><i class="fas fa-sign-out-alt"></i> Logout</a
              >
            </li>
          </ul>
        </nav>
      </aside>

      <main class="main-content">
        <header class="dashboard-header">
          <h1>Employer Dashboard</h1>
          <div class="stats">
            <div class="stat-card">
              <h3>12</h3>
              <p>Active Jobs</p>
            </div>
            <div class="stat-card">
              <h3>45</h3>
              <p>Applications</p>
            </div>
          </div>
        </header>

        <!-- Company Profile Section -->
        <section id="profile" class="dashboard-section">
          <h2>Company Profile</h2>
          <form id="companyProfileForm">
            <div class="form-group">
              <label for="companyName">Company Name</label>
              <input type="text" id="companyName" required />
            </div>
            <div class="form-group">
              <label for="companyDescription">Company Description</label>
              <textarea id="companyDescription" rows="5" required></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="companyPhone">Phone Number</label>
                <input type="tel" id="companyPhone" required />
              </div>
              <div class="form-group">
                <label for="companyLocation">Location</label>
                <input type="text" id="companyLocation" required />
              </div>
            </div>
            <div class="form-group">
              <label for="companyWebsite">Website (optional)</label>
              <input type="url" id="companyWebsite" />
            </div>
            <button type="submit" class="btn btn-primary">Save Profile</button>
          </form>
        </section>

        <!-- Post Job Section -->
        <section id="post-job" class="dashboard-section">
          <h2>Post a New Job</h2>
          <form id="postJobForm">
            <div class="form-group">
              <label for="jobTitle">Job Title</label>
              <input type="text" id="jobTitle" required />
            </div>
            <div class="form-group">
              <label for="jobDescription">Job Description</label>
              <textarea id="jobDescription" rows="5" required></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="jobLocation">Location</label>
                <input type="text" id="jobLocation" required />
              </div>
              <div class="form-group">
                <label for="jobSalary">Salary</label>
                <input type="text" id="jobSalary" required />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="jobType">Job Type</label>
                <select id="jobType" required>
                  <option value="full-time">Full-time</option>
                  <option value="part-time">Part-time</option>
                  <option value="freelancer">Freelancer</option>
                  <option value="contract">Contract</option>
                  <option value="internship">Internship</option>
                </select>
              </div>
              <div class="form-group">
                <label for="jobStatus">Status</label>
                <select id="jobStatus" required>
                  <option value="open">Open</option>
                  <option value="closed">Closed</option>
                </select>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Post Job</button>
          </form>
        </section>

        <!-- Manage Jobs Section -->
        <section id="manage-jobs" class="dashboard-section">
          <h2>Your Job Listings</h2>
          <div class="job-listings">
            <!-- Job listings will be populated by JavaScript -->
          </div>
        </section>

        <!-- Applications Section -->
        <section id="applications" class="dashboard-section">
          <h2>Applications Received</h2>
          <div class="applications-list" id="applicationsList">
            <!-- Applications will be populated here -->
          </div>
        </section>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Set the company name if available
        const currentEmployer =
          JSON.parse(localStorage.getItem("currentEmployer")) || {};
        if (currentEmployer.companyName) {
          document.getElementById("companyName").value =
            currentEmployer.companyName;
          document.getElementById("userName").textContent =
            currentEmployer.companyName;
        }

        // Handle logout
        document
          .getElementById("logout")
          .addEventListener("click", function (e) {
            e.preventDefault();

            // Get the current user's credentials from localStorage
            const users = JSON.parse(localStorage.getItem("employers")) || [];
            const currentUser = JSON.parse(
              localStorage.getItem("currentEmployer")
            );

            if (currentUser) {
              // Update the user's credentials in the employers array
              const updatedUsers = users.map((user) => {
                if (user.email === currentUser.email) {
                  return {
                    ...user,
                    // Save any updated profile information
                    companyName: document.getElementById("companyName").value,
                    companyDescription:
                      document.getElementById("companyDescription").value,
                    companyPhone: document.getElementById("companyPhone").value,
                    companyLocation:
                      document.getElementById("companyLocation").value,
                    companyWebsite:
                      document.getElementById("companyWebsite").value,
                  };
                }
                return user;
              });

              // Save the updated users array
              localStorage.setItem("employers", JSON.stringify(updatedUsers));
            }

            // Remove current user from localStorage
            localStorage.removeItem("currentEmployer");

            // Redirect to login page
            window.location.href = "login.html";
          });

        // Update the postJobForm submit handler
        document
          .getElementById("postJobForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const currentEmployer = JSON.parse(
              localStorage.getItem("currentEmployer")
            );
            const isEditMode = this.dataset.editMode === "true";

            const jobData = {
              id: isEditMode ? parseInt(this.dataset.jobId) : Date.now(),
              title: document.getElementById("jobTitle").value,
              description: document.getElementById("jobDescription").value,
              location: document.getElementById("jobLocation").value,
              salary: document.getElementById("jobSalary").value,
              type: document.getElementById("jobType").value,
              status: document.getElementById("jobStatus").value,
              company: currentEmployer.companyName || "My Company",
              postedDate: new Date().toLocaleDateString(),
              employerId: currentEmployer.email,
            };

            let jobs = JSON.parse(localStorage.getItem("jobs")) || [];

            if (isEditMode) {
              jobs = jobs.map((job) => (job.id === jobData.id ? jobData : job));
            } else {
              jobs.push(jobData);
            }

            localStorage.setItem("jobs", JSON.stringify(jobs));
            alert(
              isEditMode
                ? "Job updated successfully!"
                : "Job posted successfully!"
            );
            this.reset();
            delete this.dataset.editMode;
            delete this.dataset.jobId;
            this.querySelector("button").textContent = "Post Job";
            updateEmployerJobListings();
          });

        // Enhanced updateEmployerJobListings function
        function updateEmployerJobListings() {
          const currentEmployer = JSON.parse(
            localStorage.getItem("currentEmployer")
          );
          const jobs = JSON.parse(localStorage.getItem("jobs")) || [];
          const container = document.querySelector(
            "#manage-jobs .job-listings"
          );
          container.innerHTML = "";

          // Filter jobs for this employer
          const employerJobs = jobs.filter(
            (job) => job.employerId === currentEmployer.email
          );

          employerJobs.forEach((job) => {
            const jobCard = document.createElement("div");
            jobCard.className = "job-card";
            jobCard.innerHTML = `
            <h3>${job.title}</h3>
            <p>${job.description.substring(0, 100)}...</p>
            <div class="form-row">
              <p><strong>Location:</strong> ${job.location}</p>
              <p><strong>Salary:</strong> ${job.salary}</p>
            </div>
            <div class="form-row">
              <p><strong>Type:</strong> ${job.type}</p>
              <p><strong>Status:</strong> <span class="status-${job.status.replace(
                " ",
                "-"
              )}">${job.status}</span></p>
            </div>
            <div class="job-actions">
              <button class="btn btn-primary edit-btn" data-job-id="${
                job.id
              }">Edit</button>
              <button class="btn btn-danger delete-btn" data-job-id="${
                job.id
              }">Delete</button>
            </div>
          `;
            container.appendChild(jobCard);
          });

          // Add event listeners for edit/delete buttons
          document.querySelectorAll(".edit-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              editJob(this.getAttribute("data-job-id"));
            });
          });

          document.querySelectorAll(".delete-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              deleteJob(this.getAttribute("data-job-id"));
            });
          });
        }

        function editJob(jobId) {
          const jobs = JSON.parse(localStorage.getItem("jobs")) || [];
          const job = jobs.find((j) => j.id == jobId);

          if (!job) return;

          // Populate the post job form with this job's data
          document.getElementById("jobTitle").value = job.title;
          document.getElementById("jobDescription").value = job.description;
          document.getElementById("jobLocation").value = job.location;
          document.getElementById("jobSalary").value = job.salary;
          document.getElementById("jobType").value = job.type;
          document.getElementById("jobStatus").value = job.status;

          // Scroll to the form
          document.getElementById("post-job").scrollIntoView();

          // Change form to update mode
          const form = document.getElementById("postJobForm");
          form.dataset.editMode = "true";
          form.dataset.jobId = jobId;
          form.querySelector("button").textContent = "Update Job";
        }

        function deleteJob(jobId) {
          if (!confirm("Are you sure you want to delete this job posting?"))
            return;

          let jobs = JSON.parse(localStorage.getItem("jobs")) || [];
          jobs = jobs.filter((job) => job.id != jobId);

          localStorage.setItem("jobs", JSON.stringify(jobs));
          updateEmployerJobListings();

          // Also remove any applications for this job
          let applications =
            JSON.parse(localStorage.getItem("applications")) || [];
          applications = applications.filter((app) => app.jobId != jobId);
          localStorage.setItem("applications", JSON.stringify(applications));
        }

        // Enhanced updateApplicationStatus function
        function updateApplicationStatus(appId, status) {
          let applications =
            JSON.parse(localStorage.getItem("applications")) || [];
          applications = applications.map((app) => {
            if (app.id == appId) {
              return { ...app, status: status };
            }
            return app;
          });

          localStorage.setItem("applications", JSON.stringify(applications));
          updateEmployerApplications();

          // In a real app, you would send a notification to the seeker
          alert(`Application status updated to ${status}`);
        }

        // Enhanced updateEmployerApplications function
        function updateEmployerApplications() {
          const container = document.getElementById("applicationsList");
          container.innerHTML = "";

          const currentEmployer = JSON.parse(
            localStorage.getItem("currentEmployer")
          );
          const applications =
            JSON.parse(localStorage.getItem("applications")) || [];

          // Filter applications for this employer's jobs
          const employerApplications = applications.filter(
            (app) => app.employerId === currentEmployer.email
          );

          employerApplications.forEach((app) => {
            const card = document.createElement("div");
            card.className = "application-card";
            card.innerHTML = `
            <h3>${app.seekerName} - ${app.title}</h3>
            <p><strong>Company:</strong> ${app.company}</p>
            <p><strong>Applied:</strong> ${app.appliedDate}</p>
            <p><strong>Status:</strong> 
              <span class="status-${app.status}">${app.status}</span>
            </p>
            <div class="applicant-info">
              <p><strong>Email:</strong> ${app.seekerEmail}</p>
              <p><strong>Phone:</strong> ${app.seekerPhone}</p>
              ${
                app.seekerSkills
                  ? `<p><strong>Skills:</strong> ${app.seekerSkills.join(
                      ", "
                    )}</p>`
                  : ""
              }
            </div>
            ${
              app.status === "pending"
                ? `
            <div class="application-actions">
              <button class="btn btn-primary accept-btn" data-app-id="${app.id}">
                Accept
              </button>
              <button class="btn btn-danger reject-btn" data-app-id="${app.id}">
                Reject
              </button>
            </div>
            `
                : ""
            }
          `;
            container.appendChild(card);
          });

          // Add event listeners
          document.querySelectorAll(".accept-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              updateApplicationStatus(
                this.getAttribute("data-app-id"),
                "accepted"
              );
            });
          });

          document.querySelectorAll(".reject-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              updateApplicationStatus(
                this.getAttribute("data-app-id"),
                "rejected"
              );
            });
          });
        }

        // Simple form handling for demonstration
        document
          .getElementById("companyProfileForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const currentEmployer =
              JSON.parse(localStorage.getItem("currentEmployer")) || {};
            const updatedProfile = {
              ...currentEmployer,
              companyName: document.getElementById("companyName").value,
              companyDescription:
                document.getElementById("companyDescription").value,
              companyPhone: document.getElementById("companyPhone").value,
              companyLocation: document.getElementById("companyLocation").value,
              companyWebsite: document.getElementById("companyWebsite").value,
            };

            localStorage.setItem(
              "currentEmployer",
              JSON.stringify(updatedProfile)
            );
            document.getElementById("userName").textContent =
              updatedProfile.companyName;
            alert("Company profile saved successfully!");
          });

        // Navigation highlighting
        document.querySelectorAll("nav a").forEach((link) => {
          link.addEventListener("click", function () {
            document
              .querySelectorAll("nav li")
              .forEach((li) => li.classList.remove("active"));
            this.parentElement.classList.add("active");

            // Hide all sections
            document
              .querySelectorAll(".dashboard-section")
              .forEach((section) => {
                section.style.display = "none";
              });
            document.querySelector(".dashboard-header").style.display = "block";

            // Show the selected section
            const target = this.getAttribute("href");
            if (target && target.startsWith("#")) {
              document.querySelector(target).style.display = "block";
            }
          });
        });

        // Initialize the dashboard
        updateEmployerJobListings();
        updateEmployerApplications();

        // Show dashboard by default
        document.querySelector("nav li.active a").click();
      });
    </script>
  </body>
</html>
